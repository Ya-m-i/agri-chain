import{r,a as p,E as o,j as e}from"./index-BvLl77l8.js";const u=()=>{const[a,d]=r.useState("Disconnected"),[c,l]=r.useState(""),[m,g]=r.useState([]),{user:n,userType:i}=p();r.useEffect(()=>{o.connect();const s=o.getSocket();return s&&(s.on("connect",()=>{d("Connected ✅"),console.log("Socket connected successfully");const t=i==="admin"?"admin-room":`farmer-${n==null?void 0:n.id}`;t&&(o.joinRoom(t),console.log(`Joined room: ${t}`))}),s.on("disconnect",()=>{d("Disconnected ❌"),console.log("Socket disconnected")}),s.on("connect_error",t=>{d(`Connection Error: ${t.message} ❌`),console.error("Socket connection error:",t)}),s.on("test-message",t=>{g(b=>[...b,{id:Date.now(),message:t,timestamp:new Date().toLocaleTimeString()}])})),()=>{s&&(s.off("connect"),s.off("disconnect"),s.off("connect_error"),s.off("test-message"))}},[n==null?void 0:n.id,i]);const x=()=>{c.trim()&&(o.emit("test-message",{message:c,sender:i,senderId:n==null?void 0:n.id,timestamp:new Date().toISOString()}),l(""))},h=()=>{o.emit("ping",{timestamp:Date.now()})};return e.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"🔗 Real-Time Connection Test"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Connection Status"}),e.jsx("div",{className:`p-3 rounded ${a.includes("✅")?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a}),e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"Backend URL:"})," ","https://agri-chain.onrender.com"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Frontend URL:"})," ",window.location.origin]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User Type:"})," ",i," | ",e.jsx("strong",{children:"User ID:"})," ",(n==null?void 0:n.id)||"Not logged in"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Connection Tests"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Ping Server"}),e.jsx("button",{onClick:()=>o.connect(),className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"Reconnect"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Send Test Message"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:c,onChange:s=>l(s.target.value),placeholder:"Enter test message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:s=>s.key==="Enter"&&x()}),e.jsx("button",{onClick:x,disabled:!c.trim(),className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:bg-gray-400",children:"Send"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Received Messages"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-gray-300 rounded p-2",children:m.length===0?e.jsx("p",{className:"text-gray-500",children:"No messages received yet..."}):m.map(s=>e.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded",children:[e.jsx("div",{className:"text-sm text-gray-600",children:s.timestamp}),e.jsx("div",{children:s.message})]},s.id))})]}),e.jsxs("div",{className:"mt-6 p-3 bg-gray-100 rounded text-sm",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Environment Variables:"}),e.jsxs("div",{children:["VITE_API_URL: ","https://agri-chain.onrender.com"]}),e.jsxs("div",{children:["VITE_SOCKET_URL: ","https://agri-chain.onrender.com"]}),e.jsxs("div",{children:["NODE_ENV: ","Not set"]}),e.jsxs("div",{children:["MODE: ","production"]})]})]})};export{u as default};
