import{u as f,a as v,b as w,j as e}from"./index-FVHiMq2X.js";import{r as h}from"./chunk-_R7uuz6g.js";import{h as T,i as C}from"./chunk-BrzW1TSH.js";import"./chunk-sOp0cimv.js";import"./chunk-CdYjsaZ7.js";import"./chunk-Bz5IV6q8.js";import"./chunk-CISguUcv.js";const A=()=>{const{user:n,userType:c}=f(),[l,o]=h.useState([]),p=v(),{data:i=[],isLoading:g}=T(c==="farmer"?n==null?void 0:n.id:null),{data:m=[],isLoading:u}=C(),{isConnected:d,socket:r}=w();h.useEffect(()=>{if(!r)return;const t=["claim-created","claim-updated","assistance-created","application-created","application-updated"].map(a=>{const x=y=>{o(N=>[...N,{id:Date.now(),event:a,data:y,timestamp:new Date().toISOString()}])};return r.on(a,x),()=>r.off(a,x)});return()=>{t.forEach(a=>a())}},[r]);const b=()=>{if(i.length>0){const s={...i[0],status:"approved",adminFeedback:"Test approval via Socket.IO"};p(["claims"],t=>Array.isArray(t)?t.map(a=>a._id===s._id?s:a):t)}},j=()=>{o([])};return n?e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Socket.IO + React Query Integration Test"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${d?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${d?"bg-green-500":"bg-red-500"}`}),d?"Connected":"Disconnected"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["User: ",(n==null?void 0:n.name)||"Unknown"," (",c,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-blue-800 mb-2",children:["Claims Data (",i.length," items)"]}),g?e.jsx("p",{className:"text-blue-600",children:"Loading..."}):e.jsx("div",{className:"space-y-2",children:i.slice(0,3).map(s=>{var t;return e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",(t=s._id)==null?void 0:t.slice(-6),e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-1 px-2 py-0.5 rounded text-xs ${s.status==="approved"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.status})]},s._id)})})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-green-800 mb-2",children:["Assistance Data (",m.length," items)"]}),u?e.jsx("p",{className:"text-green-600",children:"Loading..."}):e.jsx("div",{className:"space-y-2",children:m.slice(0,3).map(s=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",s.assistanceType,e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Available:"})," ",s.availableQuantity]},s._id))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Test Controls"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:b,disabled:i.length===0,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-sm",children:"Test Claim Update"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm",children:"Clear Events"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["Real-time Events (",l.length,")"]}),l.length>0&&e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"âœ“ Socket.IO working!"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 max-h-64 overflow-y-auto",children:l.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No real-time events received yet. Try creating or updating claims/assistance in another tab."}):e.jsx("div",{className:"space-y-2",children:l.slice().reverse().map(s=>e.jsx("div",{className:"bg-white p-3 rounded border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-800",children:s.event}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.data._id?`ID: ${s.data._id.slice(-6)}`:"No ID",s.data.status&&` - Status: ${s.data.status}`,s.data.assistanceType&&` - Type: ${s.data.assistanceType}`]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleTimeString()})]})},s.id))})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"How to Test:"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"1. Ensure both frontend and backend servers are running"}),e.jsx("li",{children:"2. Open this page in one tab and the dashboard in another"}),e.jsx("li",{children:"3. Create or update claims/assistance in the dashboard"}),e.jsx("li",{children:"4. Watch this component for real-time updates without page refresh"}),e.jsx("li",{children:"5. Events should appear in the log above when changes occur"})]})]})]}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800",children:"Please log in to test Socket.IO integration"})})};export{A as default};
