import{a as f,r as p,h as v,i as w,j as e}from"./index-Cys3xZlE.js";import{h as T,i as k}from"./useAPI-DHtguvGm.js";import"./api-DvhSG3ud.js";const I=()=>{const{user:n,userType:c}=f(),[i,o]=p.useState([]),g=v(),{data:l=[],isLoading:u}=T(c==="farmer"?n==null?void 0:n.id:null),{data:m=[],isLoading:b}=k(),{isConnected:r,socket:d}=w();p.useEffect(()=>{if(!d)return;const a=["claim-created","claim-updated","assistance-created","application-created","application-updated"].map(t=>{const x=h=>{o(N=>[...N,{id:Date.now(),event:t,data:h,timestamp:new Date().toISOString()}]),console.log(`Socket event received: ${t}`,h)};return d.on(t,x),()=>d.off(t,x)});return()=>{a.forEach(t=>t())}},[d]);const j=()=>{if(l.length>0){const s={...l[0],status:"approved",adminFeedback:"Test approval via Socket.IO"};g(["claims"],a=>Array.isArray(a)?a.map(t=>t._id===s._id?s:t):a)}},y=()=>{o([])};return n?e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Socket.IO + React Query Integration Test"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${r?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${r?"bg-green-500":"bg-red-500"}`}),r?"Connected":"Disconnected"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["User: ",(n==null?void 0:n.name)||"Unknown"," (",c,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-blue-800 mb-2",children:["Claims Data (",l.length," items)"]}),u?e.jsx("p",{className:"text-blue-600",children:"Loading..."}):e.jsx("div",{className:"space-y-2",children:l.slice(0,3).map(s=>{var a;return e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",(a=s._id)==null?void 0:a.slice(-6),e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-1 px-2 py-0.5 rounded text-xs ${s.status==="approved"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.status})]},s._id)})})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-green-800 mb-2",children:["Assistance Data (",m.length," items)"]}),b?e.jsx("p",{className:"text-green-600",children:"Loading..."}):e.jsx("div",{className:"space-y-2",children:m.slice(0,3).map(s=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",s.assistanceType,e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Available:"})," ",s.availableQuantity]},s._id))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Test Controls"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:j,disabled:l.length===0,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-sm",children:"Test Claim Update"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm",children:"Clear Events"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["Real-time Events (",i.length,")"]}),i.length>0&&e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"âœ“ Socket.IO working!"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 max-h-64 overflow-y-auto",children:i.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No real-time events received yet. Try creating or updating claims/assistance in another tab."}):e.jsx("div",{className:"space-y-2",children:i.slice().reverse().map(s=>e.jsx("div",{className:"bg-white p-3 rounded border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-800",children:s.event}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.data._id?`ID: ${s.data._id.slice(-6)}`:"No ID",s.data.status&&` - Status: ${s.data.status}`,s.data.assistanceType&&` - Type: ${s.data.assistanceType}`]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleTimeString()})]})},s.id))})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"How to Test:"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"1. Ensure both frontend and backend servers are running"}),e.jsx("li",{children:"2. Open this page in one tab and the dashboard in another"}),e.jsx("li",{children:"3. Create or update claims/assistance in the dashboard"}),e.jsx("li",{children:"4. Watch this component for real-time updates without page refresh"}),e.jsx("li",{children:"5. Events should appear in the log above when changes occur"})]})]})]}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800",children:"Please log in to test Socket.IO integration"})})};export{I as default};
