import{f as ie,p as ce,a as te,j as e,R as w,r as v,u as de,h as Q}from"./index-CizZKi4t.js";import{u as me,P as ue}from"./notificationStore-DwZwBwHI.js";import{a as X,c as ge,f as he}from"./api-DvhSG3ud.js";import{M as pe,T as fe}from"./trash-2-vioDbxXN.js";const S=ie(ce((a,s)=>({step:1,formData:{name:"",address:"",phone:"",farmerLocation:"",crop:"",otherCropText:"",areaInsured:"",varietyPlanted:"",plantingDate:"",cicNumber:"",underwriter:"",program:[],otherProgramText:"",sketchFile:null,documents:[],damageType:"",lossDate:"",ageStage:"",areaDamaged:"",degreeOfDamage:"",expectedHarvest:"",damagePhotos:[],lotBoundaries:{1:{north:"",south:"",east:"",west:""},2:{north:"",south:"",east:"",west:""},3:{north:"",south:"",east:"",west:""},4:{north:"",south:"",east:"",west:""}},errors:{},touched:{}},isSubmitting:!1,submittedClaims:[],setStep:t=>a(()=>({step:t})),updateForm:(t,r)=>a(l=>({formData:{...l.formData,[t]:r,errors:{...l.formData.errors,[t]:void 0}}})),updateLotBoundary:(t,r,l)=>a(i=>({formData:{...i.formData,lotBoundaries:{...i.formData.lotBoundaries,[t]:{...i.formData.lotBoundaries[t],[r]:l}}}})),addDocument:t=>a(r=>({formData:{...r.formData,documents:[...r.formData.documents,...t]}})),removeDocument:t=>a(r=>({formData:{...r.formData,documents:r.formData.documents.filter((l,i)=>i!==t)}})),addDamagePhoto:t=>a(r=>({formData:{...r.formData,damagePhotos:[...r.formData.damagePhotos,...t]}})),removeDamagePhoto:t=>a(r=>({formData:{...r.formData,damagePhotos:r.formData.damagePhotos.filter((l,i)=>i!==t)}})),resetForm:()=>a(()=>({step:1,formData:{name:"",address:"",phone:"",farmerLocation:"",crop:"",otherCropText:"",areaInsured:"",varietyPlanted:"",plantingDate:"",cicNumber:"",underwriter:"",program:[],otherProgramText:"",sketchFile:null,documents:[],damageType:"",lossDate:"",ageStage:"",areaDamaged:"",degreeOfDamage:"",expectedHarvest:"",damagePhotos:[],lotBoundaries:{1:{north:"",south:"",east:"",west:""},2:{north:"",south:"",east:"",west:""},3:{north:"",south:"",east:"",west:""},4:{north:"",south:"",east:"",west:""}},errors:{},touched:{}}})),validateStep:t=>{const{formData:r}=s(),l={};return t===1&&(r.name||(l.name="Name is required"),r.address||(l.address="Address is required"),r.phone||(l.phone="Phone number is required"),r.crop||(l.crop="Crop type is required"),r.crop==="Other"&&!r.otherCropText&&(l.otherCropText="Please specify the crop type"),r.areaInsured||(l.areaInsured="Area insured is required")),t===2&&(r.damageType||(l.damageType="Cause of loss is required"),r.lossDate||(l.lossDate="Date of loss is required"),r.ageStage||(l.ageStage="Age/Stage is required"),r.areaDamaged||(l.areaDamaged="Area damaged is required"),r.degreeOfDamage||(l.degreeOfDamage="Degree of damage is required"),(!r.damagePhotos||r.damagePhotos.length===0)&&(l.damagePhotos="At least one damage photo is required")),a(i=>({formData:{...i.formData,errors:l}})),Object.keys(l).length===0},setFieldTouched:t=>{a(r=>({formData:{...r.formData,touched:{...r.formData.touched,[t]:!0}}}))},submitForm:async()=>{a({isSubmitting:!0});try{console.log("ClaimFormStore: Starting form submission..."),console.log("ClaimFormStore: User agent:",navigator.userAgent),console.log("ClaimFormStore: Is mobile:",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));const{formData:t}=s(),r=te.getState().user;if(!r)throw new Error("User not authenticated. Please login again.");if(console.log("ClaimFormStore: User data:",r),console.log("ClaimFormStore: Form data:",t),!t.crop)throw new Error("Crop type is required");if(!t.areaDamaged||parseFloat(t.areaDamaged)<=0)throw new Error("Area damaged must be greater than 0");if(!t.degreeOfDamage||parseFloat(t.degreeOfDamage)<=0)throw new Error("Degree of damage must be greater than 0");const i=await(async m=>{const b=[];for(const p of m)if(p instanceof File)try{const D=await new Promise((y,d)=>{const f=new FileReader;f.onload=()=>y(f.result),f.onerror=d,f.readAsDataURL(p)});b.push(D)}catch{b.push("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==")}else typeof p=="string"&&p.startsWith("data:")?b.push(p):b.push("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==");return b})(t.damagePhotos);console.log("ClaimFormStore: Converted photos count:",i.length);const u={farmerId:r.id,name:r.name,address:r.address,phone:r.phone,crop:t.crop==="Other"?t.otherCropText:t.crop,areaInsured:parseFloat(t.areaInsured)||0,program:t.program,varietyPlanted:t.varietyPlanted,plantingDate:t.plantingDate?new Date(t.plantingDate).toISOString():null,cicNumber:t.cicNumber,underwriter:t.underwriter,damageType:t.damageType,lossDate:t.lossDate?new Date(t.lossDate).toISOString():null,ageStage:t.ageStage,areaDamaged:parseFloat(t.areaDamaged)||0,degreeOfDamage:parseFloat(t.degreeOfDamage)||0,expectedHarvest:t.expectedHarvest,damagePhotos:i,lotBoundaries:t.lotBoundaries,status:"pending",date:new Date().toISOString(),reviewDate:null,completionDate:null};console.log("ClaimFormStore: Submitting claim with data:",u);const o=await ge(u);console.log("ClaimFormStore: Claim submission result:",o);let c,g;return console.log("ClaimFormStore: Raw backend response:",JSON.stringify(o,null,2)),o.claimNumber?c=o.claimNumber:o.data&&o.data.claimNumber?c=o.data.claimNumber:o.claim&&o.claim.claimNumber?c=o.claim.claimNumber:(console.warn("ClaimFormStore: claimNumber not found in expected locations, using fallback"),c="Unknown"),o._id?g=o._id:o.data&&o.data._id?g=o.data._id:o.claim&&o.claim._id?g=o.claim._id:g=null,console.log("ClaimFormStore: Extracted claimNumber:",c),console.log("ClaimFormStore: Extracted claimId:",g),a({isSubmitting:!1}),s().resetForm(),r&&r.id&&me.getState().addFarmerNotification({id:`claim-submitted-${g||Date.now()}`,type:"success",title:"Claim Submitted Successfully",message:`Your claim for ${u.crop} has been submitted with claim number ${c}.`,timestamp:new Date},r.id),setTimeout(()=>{window.dispatchEvent(new CustomEvent("claimSubmitted",{detail:{claimId:g,claimNumber:c,crop:u.crop}}))},1e3),Promise.resolve()}catch(t){return console.error("ClaimFormStore: Claim submission error:",t),console.error("ClaimFormStore: Error details:",{message:t.message,stack:t.stack,name:t.name}),a({isSubmitting:!1}),Promise.reject(t.message||"Failed to submit claim")}},getClaimsForFarmer:async t=>{try{return await X(t)}catch{return[]}},getClaims:async()=>{try{return await X()}catch{return[]}},updateClaimStatus:(t,r,l,i)=>{a(u=>({submittedClaims:u.submittedClaims.map(o=>o.id===t?{...o,status:r,adminFeedback:l,compensation:i}:o)}))}}),{name:"claim-form-storage",partialize:a=>{const{formData:s,step:t,submittedClaims:r}=a;return{step:t,submittedClaims:r,formData:{...s,sketchFile:null,documents:[],damagePhotos:[],errors:{},touched:{}}}}})),xe=()=>{const{step:a,setStep:s}=S(),t=a/3*100;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full bg-gray-300 rounded-full h-4 mb-8",children:e.jsx("div",{className:"bg-green-600 h-4 rounded-full transition-all duration-500 ease-in-out",style:{width:`${t}%`}})}),e.jsx("div",{className:"flex justify-around items-center mb-8",children:[1,2,3].map(r=>e.jsxs("button",{onClick:()=>s(r),className:`px-6 py-3 rounded-full shadow-lg font-semibold text-lg focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2 transition-all duration-200 ${a===r?"bg-green-700 text-white transform scale-105":"bg-gray-300 text-gray-700 hover:bg-gray-400"}`,children:["Step ",r]},r))})]})};var re={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Z=w.createContext&&w.createContext(re),be=["attr","size","title"];function ve(a,s){if(a==null)return{};var t=je(a,s),r,l;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(l=0;l<i.length;l++)r=i[l],!(s.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(a,r)&&(t[r]=a[r])}return t}function je(a,s){if(a==null)return{};var t={};for(var r in a)if(Object.prototype.hasOwnProperty.call(a,r)){if(s.indexOf(r)>=0)continue;t[r]=a[r]}return t}function A(){return A=Object.assign?Object.assign.bind():function(a){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(a[r]=t[r])}return a},A.apply(this,arguments)}function ee(a,s){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);s&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(a,l).enumerable})),t.push.apply(t,r)}return t}function k(a){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?ee(Object(t),!0).forEach(function(r){ye(a,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):ee(Object(t)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))})}return a}function ye(a,s,t){return s=Ne(s),s in a?Object.defineProperty(a,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[s]=t,a}function Ne(a){var s=we(a,"string");return typeof s=="symbol"?s:s+""}function we(a,s){if(typeof a!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var r=t.call(a,s);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function se(a){return a&&a.map((s,t)=>w.createElement(s.tag,k({key:t},s.attr),se(s.child)))}function j(a){return s=>w.createElement(De,A({attr:k({},a.attr)},s),se(a.child))}function De(a){var s=t=>{var{attr:r,size:l,title:i}=a,u=ve(a,be),o=l||t.size||"1em",c;return t.className&&(c=t.className),a.className&&(c=(c?c+" ":"")+a.className),w.createElement("svg",A({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,u,{className:c,style:k(k({color:a.color||t.color},t.style),a.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),i&&w.createElement("title",null,i),a.children)};return Z!==void 0?w.createElement(Z.Consumer,null,t=>s(t)):s(re)}function Ce(a){return j({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"},child:[]}]})(a)}function Se(a){return j({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M575.2 325.7c.2-1.9.8-3.7.8-5.6 0-35.3-28.7-64-64-64-12.6 0-24.2 3.8-34.1 10-17.6-38.8-56.5-66-101.9-66-61.8 0-112 50.1-112 112 0 3 .7 5.8.9 8.7-49.6 3.7-88.9 44.7-88.9 95.3 0 53 43 96 96 96h272c53 0 96-43 96-96 0-42.1-27.2-77.4-64.8-90.4zm-430.4-22.6c-43.7-43.7-43.7-114.7 0-158.3 43.7-43.7 114.7-43.7 158.4 0 9.7 9.7 16.9 20.9 22.3 32.7 9.8-3.7 20.1-6 30.7-7.5L386 81.1c4-11.9-7.3-23.1-19.2-19.2L279 91.2 237.5 8.4C232-2.8 216-2.8 210.4 8.4L169 91.2 81.1 61.9C69.3 58 58 69.3 61.9 81.1l29.3 87.8-82.8 41.5c-11.2 5.6-11.2 21.5 0 27.1l82.8 41.4-29.3 87.8c-4 11.9 7.3 23.1 19.2 19.2l76.1-25.3c6.1-12.4 14-23.7 23.6-33.5-13.1-5.4-25.4-13.4-36-24zm-4.8-79.2c0 40.8 29.3 74.8 67.9 82.3 8-4.7 16.3-8.8 25.2-11.7 5.4-44.3 31-82.5 67.4-105C287.3 160.4 258 140 224 140c-46.3 0-84 37.6-84 83.9z"},child:[]}]})(a)}function Fe(a){return j({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(a)}function ae(a){return j({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(a)}function Pe(a){return j({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(a)}function Ae(a){return j({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M64 96H0c0 123.7 100.3 224 224 224v144c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V320C288 196.3 187.7 96 64 96zm384-64c-84.2 0-157.4 46.5-195.7 115.2 27.7 30.2 48.2 66.9 59 107.6C424 243.1 512 147.9 512 32h-64z"},child:[]}]})(a)}function ke(a){return j({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(a)}function Oe(a){return j({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(a)}const Be=()=>{var y,d,f,I,E,T,L,R,z,U,M,$,q,H,_,V,J,G,W,Y,K;const{formData:a,updateForm:s,setFieldTouched:t}=S(),r=te(n=>n.user),[l,i]=v.useState([]),[u,o]=v.useState({}),[c,g]=v.useState({});v.useEffect(()=>{if(r){s("name",r.name||""),s("address",r.address||""),s("phone",r.phone||""),s("crop",r.cropType||""),s("areaInsured",r.cropArea||"");const h=JSON.parse(localStorage.getItem("farmers")||"[]").find(x=>x.farmerName===r.name||x.id===r.id||`${x.firstName} ${x.middleName} ${x.lastName}`.trim()===r.name);if(h&&h.rsbsaRegistered){const x=a.program||[];x.includes("RSBA")||s("program",[...x,"RSBA"])}}},[r,a.program,s]),v.useEffect(()=>{async function n(){if(!(r!=null&&r._id))return;const h=await he(r._id),x=new Date,F=[],P={},O={};h.forEach(B=>{const N=B.cropType,oe=new Date(B.plantingDate),le=parseInt(B.insuranceDayLimit),ne=Math.floor((x-oe)/(1e3*60*60*24)),C=le-ne;C>=0?(F.push(N),P[N]=C,C<=5&&(O[N]=C===0?`Claim period for ${N} is over!`:`Only ${C} day(s) left to file a claim for ${N}!`)):O[N]=`Claim period for ${N} is over!`}),i(F),o(P),g(O)}n()},[r]);const m=(n,h)=>{s(n,h)},b=n=>{var x;const h=(x=n.target.files)==null?void 0:x[0];h&&m("sketchFile",h)},p=n=>{const h=n.target.files?Array.from(n.target.files):[],x=a.documents||[];s("documents",[...x,...h])},D=n=>{const h=[...a.documents];h.splice(n,1),s("documents",h)};return e.jsxs("section",{className:"animate-fade-in",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 mb-8 flex items-center gap-2",children:[e.jsx(Ae,{className:"text-green-500"})," I. Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-gray-700 font-semibold mb-2",htmlFor:"farmer-name",children:["Name of Farmer-Assured ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"farmer-name",placeholder:"Juan Dela Cruz",className:`pl-12 border p-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-400 ${(y=a.errors)!=null&&y.name&&((d=a.touched)!=null&&d.name)?"border-red-500":""}`,value:a.name,onChange:n=>m("name",n.target.value),onBlur:()=>t("name"),required:!0}),e.jsx(Fe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),((f=a.errors)==null?void 0:f.name)&&((I=a.touched)==null?void 0:I.name)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.name})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-gray-700 font-semibold mb-2",htmlFor:"address",children:["Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"address",placeholder:"123 Rizal St, Sampaloc, Manila",className:`pl-12 border p-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-400 ${(E=a.errors)!=null&&E.address&&((T=a.touched)!=null&&T.address)?"border-red-500":""}`,value:a.address,onChange:n=>m("address",n.target.value),onBlur:()=>t("address"),required:!0})]}),((L=a.errors)==null?void 0:L.address)&&((R=a.touched)==null?void 0:R.address)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.address})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-gray-700 font-semibold mb-2",htmlFor:"phone",children:["Cellphone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"phone",placeholder:"09123456789",className:`pl-12 border p-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-400 ${(z=a.errors)!=null&&z.phone&&((U=a.touched)!=null&&U.phone)?"border-red-500":""}`,value:a.phone,onChange:n=>m("phone",n.target.value),onBlur:()=>t("phone"),required:!0})]}),((M=a.errors)==null?void 0:M.phone)&&(($=a.touched)==null?void 0:$.phone)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.phone})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-gray-700 font-semibold mb-2",htmlFor:"farmer-location",children:["Location of Farmer ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{id:"farmer-location",placeholder:"Barangay San Isidro, Quezon City",className:"pl-12 border p-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-400",value:a.farmerLocation,onChange:n=>m("farmerLocation",n.target.value),required:!0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-gray-700 font-semibold mb-2",htmlFor:"crop-type",children:["Insured Crops ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{id:"crop-type",className:`border p-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-400 ${(q=a.errors)!=null&&q.crop&&((H=a.touched)!=null&&H.crop)?"border-red-500":""}`,value:a.crop,onChange:n=>m("crop",n.target.value),onBlur:()=>t("crop"),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:l.length===0?"No insured crops available":"Select a crop"}),l.map(n=>e.jsxs("option",{value:n,children:[n," ",u[n]!==void 0?`(Days left: ${u[n]})`:""]},n))]}),a.crop&&c[a.crop]&&e.jsx("span",{className:`text-sm ${c[a.crop].includes("over")?"text-red-500":"text-yellow-600"}`,children:c[a.crop]})]}),((_=a.errors)==null?void 0:_.crop)&&((V=a.touched)==null?void 0:V.crop)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.crop})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-gray-700 font-semibold mb-2",htmlFor:"area-insured",children:["Area Insured (hectares) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"area-insured",placeholder:"5.0",className:`pl-4 border p-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-400 ${(J=a.errors)!=null&&J.areaInsured&&((G=a.touched)!=null&&G.areaInsured)?"border-red-500":""}`,value:a.areaInsured,onChange:n=>m("areaInsured",n.target.value),onBlur:()=>t("areaInsured"),required:!0}),((W=a.errors)==null?void 0:W.areaInsured)&&((Y=a.touched)==null?void 0:Y.areaInsured)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.areaInsured})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-gray-700 font-semibold mb-2",children:["Program ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:["Regular","Sikat Saka","RSBA","APCP-CAP-PBD","PUNA","Cooperative Rice Farming"].map(n=>e.jsxs("label",{className:"inline-flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox h-5 w-5 text-green-600",checked:a.program.includes(n),onChange:h=>{const F=h.target.checked?[...a.program,n]:a.program.filter(P=>P!==n);m("program",F)}}),e.jsx("span",{className:"text-gray-700",children:n})]},n))}),((K=a.errors)==null?void 0:K.program)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.program})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Sketch File"}),e.jsx("input",{type:"file",className:"border p-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-400",onChange:b}),a.sketchFile&&e.jsxs("p",{className:"mt-2 text-sm text-green-600",children:["File selected: ",a.sketchFile.name]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Supporting Documents"}),e.jsx("input",{type:"file",multiple:!0,className:"border p-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-400",onChange:p}),a.documents&&a.documents.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Selected files:"}),e.jsx("ul",{className:"list-disc pl-5",children:a.documents.map((n,h)=>e.jsxs("li",{className:"text-sm text-gray-600 flex justify-between items-center",children:[e.jsx("span",{children:n.name}),e.jsx("button",{type:"button",onClick:()=>D(h),className:"text-red-500 hover:text-red-700",children:"Remove"})]},h))})]})]})]})]})},Ie=()=>{var c,g,m,b,p,D,y;const{formData:a,updateForm:s,setFieldTouched:t,addDamagePhoto:r,removeDamagePhoto:l}=S();v.useEffect(()=>{s("areaDamaged",a.areaInsured||"0"),s("degreeOfDamage","50"),s("expectedHarvest","0")},[]);const i=(d,f)=>{s(d,f)},u=d=>{const f=d.target.files?Array.from(d.target.files):[];f.length>0&&r(f)},o=d=>{l(d)};return e.jsxs("section",{className:"animate-fade-in",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 mb-8 flex items-center gap-2",children:[e.jsx(Se,{className:"text-yellow-500"})," II. Damage Indicators"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Cause of Loss"}),e.jsxs("select",{value:a.damageType,onChange:d=>i("damageType",d.target.value),onBlur:()=>t("damageType"),className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-yellow-400",children:[e.jsx("option",{value:"",children:"Select cause of loss"}),e.jsx("option",{value:"Typhoon",children:"Typhoon"}),e.jsx("option",{value:"Drought",children:"Drought"}),e.jsx("option",{value:"Floods",children:"Floods"}),e.jsx("option",{value:"Pest infestations",children:"Pest infestations"}),e.jsx("option",{value:"Disease outbreaks",children:"Disease outbreaks"}),e.jsx("option",{value:"Fire",children:"Fire"}),e.jsx("option",{value:"Theft (for animals)",children:"Theft (for animals)"})]}),((c=a.errors)==null?void 0:c.damageType)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.damageType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Date of Loss"}),e.jsx("input",{type:"date",value:a.lossDate,onChange:d=>i("lossDate",d.target.value),onBlur:()=>t("lossDate"),className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-yellow-400"}),((g=a.errors)==null?void 0:g.lossDate)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.lossDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Age/Stage of Cultivation at Time of Loss"}),e.jsxs("select",{value:a.ageStage,onChange:d=>i("ageStage",d.target.value),onBlur:()=>t("ageStage"),className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-yellow-400",children:[e.jsx("option",{value:"",children:"Select growth stage"}),e.jsx("option",{value:"Vegetative Stage",children:"Vegetative Stage"}),e.jsx("option",{value:"Reproductive Stage",children:"Reproductive Stage"}),e.jsx("option",{value:"Ripening/Grain Filling Stage",children:"Ripening/Grain Filling Stage"})]}),((m=a.errors)==null?void 0:m.ageStage)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.ageStage})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Area Damaged (hectares)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:a.areaInsured,value:a.areaDamaged,onChange:d=>i("areaDamaged",d.target.value),onBlur:()=>t("areaDamaged"),className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-yellow-400",placeholder:"Enter damaged area"}),((b=a.errors)==null?void 0:b.areaDamaged)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.areaDamaged})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Degree of Damage (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:a.degreeOfDamage,onChange:d=>i("degreeOfDamage",d.target.value),onBlur:()=>t("degreeOfDamage"),className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-yellow-400",placeholder:"Enter degree of damage"}),((p=a.errors)==null?void 0:p.degreeOfDamage)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.degreeOfDamage})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Expected Harvest (tons)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:a.expectedHarvest,onChange:d=>i("expectedHarvest",d.target.value),onBlur:()=>t("expectedHarvest"),className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-yellow-400",placeholder:"Enter expected harvest"}),((D=a.errors)==null?void 0:D.expectedHarvest)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.expectedHarvest})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Damage Evidence Photos ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"border-2 border-dashed border-yellow-300 rounded-lg p-6 text-center hover:border-yellow-400 transition-colors",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:u,className:"hidden",id:"damage-photos-upload"}),e.jsxs("label",{htmlFor:"damage-photos-upload",className:"cursor-pointer",children:[e.jsx(Ce,{className:"mx-auto text-4xl text-yellow-500 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Click to upload photos of the damage"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload multiple photos showing the extent of damage"})]})]}),a.damagePhotos&&a.damagePhotos.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Uploaded Photos (",a.damagePhotos.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:a.damagePhotos.map((d,f)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:URL.createObjectURL(d),alt:`Damage evidence ${f+1}`,className:"w-full h-32 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:()=>o(f),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ke,{size:12})})]},f))})]}),((y=a.errors)==null?void 0:y.damagePhotos)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.errors.damagePhotos})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"Important Notice"}),e.jsx("p",{className:"text-yellow-800",children:"Please ensure all information provided is accurate. Claims with incorrect information may be delayed or rejected. Our team may conduct an on-site assessment to verify the damage reported."})]})]})},Ee=()=>{const{formData:a,updateLotBoundary:s}=S(),[t,r]=v.useState([1]),l=(o,c,g)=>{s(o,c,g)},i=()=>{const o=Math.max(...t)+1;r([...t,o])},u=o=>{t.length>1&&r(t.filter(c=>c!==o))};return e.jsxs("section",{className:"animate-fade-in",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 mb-8 flex items-center gap-2",children:[e.jsx(pe,{className:"text-blue-500 h-7 w-7"})," III. Location Sketch / Plan of Damaged Crops (LSP)"]}),e.jsxs("div",{className:"space-y-8",children:[t.map(o=>{var c,g,m,b;return e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200 transition-all duration-300 hover:shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx("div",{className:"bg-blue-700 text-white w-6 h-6 rounded-full flex items-center justify-center font-bold text-sm",children:o}),"Lot ",o," Details"]}),t.length>1&&e.jsx("button",{type:"button",onClick:()=>u(o),className:"text-red-500 hover:text-red-700 p-2",title:"Remove lot",children:e.jsx(fe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"North Boundary"}),e.jsx("input",{type:"text",placeholder:"e.g., Road",className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-400",value:((c=a.lotBoundaries[o])==null?void 0:c.north)||"",onChange:p=>l(o,"north",p.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"South Boundary"}),e.jsx("input",{type:"text",placeholder:"e.g., River",className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-400",value:((g=a.lotBoundaries[o])==null?void 0:g.south)||"",onChange:p=>l(o,"south",p.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"East Boundary"}),e.jsx("input",{type:"text",placeholder:"e.g., Farm",className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-400",value:((m=a.lotBoundaries[o])==null?void 0:m.east)||"",onChange:p=>l(o,"east",p.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"West Boundary"}),e.jsx("input",{type:"text",placeholder:"e.g., Canal",className:"border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-400",value:((b=a.lotBoundaries[o])==null?void 0:b.west)||"",onChange:p=>l(o,"west",p.target.value)})]})]})]},o)}),e.jsxs("button",{type:"button",onClick:i,className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 font-medium",children:[e.jsx(ue,{className:"h-5 w-5"}),"Add Another Lot"]})]}),e.jsxs("div",{className:"mt-8 bg-blue-50 rounded-lg p-6 border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Visual Farm Sketch"}),e.jsx("div",{className:"relative",children:a.sketchFile?e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-green-700 mb-2",children:["âœ“ Sketch file uploaded: ",a.sketchFile.name]}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4 h-48 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Sketch preview would appear here in a real application"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-amber-700 mb-2",children:"No sketch file uploaded yet"}),e.jsxs("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-8 flex flex-col items-center justify-center",children:[e.jsx("p",{className:"text-gray-500 mb-3",children:"Please return to Step 1 to upload a sketch of your farm"}),e.jsx("button",{onClick:()=>setStep(1),className:"bg-blue-100 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors",children:"Go to Step 1"})]})]})}),e.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Note: The sketch should clearly show the layout of your farm, including all lots, boundaries, and damaged areas."})]})]})},Ue=()=>{const a=de(),s=v.useRef(null),{step:t,setStep:r,validateStep:l,submitForm:i,isSubmitting:u}=S(),o=()=>{window.confirm("Are you sure you want to exit? Your progress will be saved.")&&a("/farmer-dashboard")},c=()=>{l(t)&&(r(t+1),window.scrollTo(0,0),s.current&&(s.current.scrollTop=0))},g=async()=>{try{console.log("FarmerForm: Starting claim submission..."),console.log("FarmerForm: User agent:",navigator.userAgent),console.log("FarmerForm: Is mobile:",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),await i(),console.log("FarmerForm: Claim submitted successfully!"),Q.success("Claim submitted successfully!"),a("/farmer-dashboard")}catch(m){console.error("FarmerForm: Submission error:",m),console.error("FarmerForm: Error details:",{message:m.message,stack:m.stack,name:m.name}),Q.error(typeof m=="string"?m:"Failed to submit claim. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-green-200 via-green-100 to-green-200 p-6 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-4xl w-full bg-white shadow-2xl rounded-3xl p-8 relative",ref:s,children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 text-gray-600 hover:text-gray-800 text-2xl font-bold focus:outline-none","aria-label":"Close form",children:"Ã—"}),e.jsxs("h1",{className:"text-5xl font-extrabold text-center text-green-800 mb-12 flex items-center justify-center gap-4",children:[e.jsx("span",{className:"text-green-600",children:"ðŸšœ"})," Claim for Indemnity"]}),e.jsx(xe,{}),t===1&&e.jsx(Be,{}),t===2&&e.jsx(Ie,{}),t===3&&e.jsx(Ee,{}),e.jsxs("div",{className:"mt-12 flex justify-between",children:[t>1&&e.jsx("button",{onClick:()=>r(t-1),className:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-full shadow-xl",children:"Back"}),e.jsx("div",{className:"ml-auto",children:t<3?e.jsx("button",{onClick:c,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-xl",children:"Continue"}):e.jsx("button",{onClick:g,disabled:u,className:`bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-xl flex items-center ${u?"opacity-75 cursor-not-allowed":""}`,children:u?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Submit Claim"})})]})]})})};export{Ue as default};
